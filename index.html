<!-- TESTA DEL DOCUMENTO RESTA INVARIATA -->

<p>Seleziona una data e un'orario a te comodo (in inglese):</p>

<!-- ... -->

<input type="date" id="appointment-date">

<div id="timeslot-container" class="hidden">
    <div class="timeslots">
        <button class="timeslot" data-time="09:00">09:00</button>
        <button class="timeslot" data-time="10:00">10:00</button>
        <button class="timeslot" data-time="11:00">11:00</button>
        <button class="timeslot" data-time="12:00">12:00</button>
        <button class="timeslot" data-time="13:00">13:00</button>
        <button class="timeslot" data-time="14:00">14:00</button>
    </div>
    <!-- FORM RESTA UGUALE -->
</div>

<!-- SCRIPT MODIFICATO QUI -->
<script>
    const dateInput = document.getElementById('appointment-date');
    const timeslotContainer = document.getElementById('timeslot-container');
    const timeslots = document.querySelectorAll('.timeslot');
    const bookingForm = document.getElementById('booking-form');
    const bookingDateInput = document.getElementById('booking-date-input');
    const bookingTimeInput = document.getElementById('booking-time-input');
    let selectedSlot = null;

    function updateMinDate() {
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);
        dateInput.setAttribute('value', today);
    }

    dateInput.addEventListener('change', function () {
        const selectedDate = new Date(this.value);
        const day = selectedDate.getDay();

        if (day >= 1 && day <= 6) { // Lunedì (1) - Sabato (6)
            timeslotContainer.classList.remove('hidden');
            timeslots.forEach(slot => slot.classList.remove('disabled'));
        } else {
            timeslotContainer.classList.add('hidden');
            timeslots.forEach(slot => slot.classList.add('disabled'));
            alert('Puoi prenotare solo dal lunedì al sabato.');
        }
    });

    timeslots.forEach(slot => {
        slot.addEventListener('click', function () {
            if (!this.classList.contains('disabled')) {
                if (selectedSlot) {
                    selectedSlot.classList.remove('selected');
                }
                this.classList.add('selected');
                selectedSlot = this;

                bookingTimeInput.value = selectedSlot.dataset.time;
                bookingDateInput.value = dateInput.value;
            }
        });
    });

    bookingForm.addEventListener('submit', function (event) {
        if (!selectedSlot) {
            event.preventDefault();
            alert('Seleziona un orario prima di confermare.');
        } else {
            alert(`Hai prenotato un appuntamento per il ${dateInput.value} alle ${selectedSlot.dataset.time}`);
        }
    });

    function updateTimeslotAvailability() {
        const selectedDate = new Date(dateInput.value);
        const day = selectedDate.getDay();

        if (day >= 1 && day <= 6) {
            timeslots.forEach(slot => {
                slot.classList.remove('disabled');
            });
        } else {
            timeslots.forEach(slot => {
                slot.classList.add('disabled');
            });
        }
    }

    dateInput.addEventListener('input', updateTimeslotAvailability);

    updateMinDate();
    updateTimeslotAvailability();
</script>
